---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';

const posts = await getCollection('blog', ({ id }) => id.startsWith('fr/'));

const tagCounts = new Map<string, number>();

posts.forEach((post) => {
  post.data.tags.forEach((tag) => {
    const normalizedTag = tag.toLowerCase();
    tagCounts.set(normalizedTag, (tagCounts.get(normalizedTag) || 0) + 1);
  });
});

const sortedTags = Array.from(tagCounts.entries()).sort((a, b) => {
  if (b[1] !== a[1]) return b[1] - a[1];
  return a[0].localeCompare(b[0]);
});
---

<BaseLayout title="Tags - Cocoweb" description="Tous les tags du blog Cocoweb." lang="fr">
  <div class="tags-page">
    <h1>Tags</h1>
    <p class="tags-description">
      Explorer les articles par sujet. {sortedTags.length} tags disponibles.
    </p>
    
    <ul class="tags-list">
      {sortedTags.map(([tag, count]) => (
        <li>
          <a href={`/fr/tags/${tag.replace(/\s+/g, '-')}/`} class="tag-link">
            <span class="tag-name">#{tag}</span>
            <span class="tag-count">{count}</span>
          </a>
        </li>
      ))}
    </ul>
  </div>
</BaseLayout>

<style>
  .tags-page {
    max-width: 42rem;
    margin: 0 auto;
  }

  .tags-description {
    opacity: 0.8;
    margin-bottom: 2rem;
  }

  .tags-list {
    list-style: none;
    padding: 0;
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .tag-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--color-surface, #f5f5f5);
    border-radius: 4px;
    text-decoration: none;
    transition: background-color 0.2s ease;
  }

  .tag-link:hover {
    background: var(--color-surface-hover, #e5e5e5);
  }

  .tag-name {
    font-weight: 500;
  }

  .tag-count {
    font-size: 0.875rem;
    opacity: 0.7;
    background: var(--color-surface-alt, #e0e0e0);
    padding: 0.125rem 0.5rem;
    border-radius: 999px;
  }
</style>
