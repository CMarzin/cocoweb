---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import PostList from '../../../components/PostList.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ id }) => id.startsWith('fr/'));
  
  const tags = new Set<string>();
  posts.forEach((post) => {
    post.data.tags.forEach((tag) => {
      tags.add(tag.toLowerCase());
    });
  });

  return Array.from(tags).map((tag) => ({
    params: { tag: tag.replace(/\s+/g, '-') },
    props: { 
      tag,
      posts: posts.filter((post) =>
        post.data.tags.some((t) => t.toLowerCase() === tag)
      ),
    },
  }));
}

interface Props {
  tag: string;
  posts: Awaited<ReturnType<typeof getCollection<'blog'>>>;
}

const { tag, posts } = Astro.props;
const postCount = posts.length;
---

<BaseLayout 
  title={`#${tag} - Cocoweb`} 
  description={`Articles avec le tag #${tag} sur Cocoweb.`}
  lang="fr"
>
  <div class="tag-page">
    <header class="tag-header">
      <a href="/fr/tags/" class="back-link">Tous les tags</a>
      <h1>#{tag}</h1>
      <p class="post-count">
        {postCount} article{postCount > 1 ? 's' : ''}
      </p>
    </header>

    <PostList posts={posts} showTags={true} basePath="/fr/blog" lang="fr" />
  </div>
</BaseLayout>
