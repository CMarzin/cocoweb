---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';

const articles = await getCollection('articles', ({ id }) => id.startsWith('fr/'));
const sortedArticles = articles.sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

function formatDate(date: Date): string {
  return date.toLocaleDateString('fr-FR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<BaseLayout 
  title="Articles - Cocoweb" 
  description="Articles techniques sur le développement web et les technologies."
  lang="fr"
>
  <div class="postlist-page">
    <h1>Articles</h1>
    <p class="postlist-description">
      Articles techniques approfondis sur le développement web.
    </p>

    {sortedArticles.length > 0 ? (
      <ol class="postlist">
        {sortedArticles.map((article) => (
          <li class="postlist-item">
            <a href={`/fr/articles/${article.slug.replace(/^fr\//, '')}/`} class="article-link">
              <time datetime={article.data.date.toISOString()}>
                {formatDate(article.data.date)}
              </time>
              <h2>{article.data.title}</h2>
            </a>
            {article.data.tags.length > 0 && (
              <div class="post-tag__container">
                {article.data.tags.map((tag) => (
                  <a
                    href={`/fr/tags/${tag.toLowerCase().replace(/\s+/g, '-')}/`}
                    class="post-tag"
                  >
                    #{tag}
                  </a>
                ))}
              </div>
            )}
          </li>
        ))}
      </ol>
    ) : (
      <p class="no-articles">Aucun article pour le moment.</p>
    )}
  </div>
</BaseLayout>