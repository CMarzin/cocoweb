---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

// Try English content first, fallback to French
let posts = await getCollection('blog', ({ id }) => id.startsWith('en/'));
if (posts.length === 0) {
  posts = await getCollection('blog', ({ id }) => id.startsWith('fr/'));
}

// Extract all unique tags and count occurrences
const tagCounts = new Map<string, number>();

posts.forEach((post) => {
  post.data.tags.forEach((tag) => {
    const normalizedTag = tag.toLowerCase();
    tagCounts.set(normalizedTag, (tagCounts.get(normalizedTag) || 0) + 1);
  });
});

// Sort tags by count (descending), then alphabetically
const sortedTags = Array.from(tagCounts.entries()).sort((a, b) => {
  if (b[1] !== a[1]) return b[1] - a[1];
  return a[0].localeCompare(b[0]);
});
---

<BaseLayout title="Tags - Cocoweb" description="All tags on the Cocoweb blog." lang="en">
  <div class="tags-page">
    <h1>Tags</h1>
    <p class="tags-description">
      Explore articles by topic. {sortedTags.length} tags available.
    </p>
    
    <ul class="tags-list">
      {sortedTags.map(([tag, count]) => (
        <li>
          <a href={`/tags/${tag.replace(/\s+/g, '-')}/`} class="tag-link">
            <span class="tag-name">#{tag}</span>
            <span class="tag-count">{count}</span>
          </a>
        </li>
      ))}
    </ul>
  </div>
</BaseLayout>
